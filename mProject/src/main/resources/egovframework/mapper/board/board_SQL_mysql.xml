<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	
	<resultMap id="board" type="egovframework.example.board.vo.boardVo">
		<result property="board_id" column="board_id"/>
		<result property="user_id" column="user_id"/>
		<result property="title" column="title"/>
		<result property="content" column="content"/>
		<result property="file_name" column="file_name"/>
		<result property="reg_dtm" column="reg_dtm"/>
	</resultMap>
	
	<resultMap id="search" type="egovframework.example.ivory.vo.Search">
		<result property="searchType" column="searchType"/>
		<result property="keyword" column="keyword"/>
	</resultMap>
	
	<resultMap id="paging" type="egovframework.example.ivory.vo.pagination">
		<result property="listSize" column="listSize"/>
		<result property="rangeSize" column="rangeSize"/>
		<result property="page" column="page"/>
		<result property="range" column="range"/>
		<result property="listCnt" column="listCnt"/>
		<result property="pageCnt" column="pageCnt"/>
		<result property="startPage" column="startPage"/>
		<result property="startList" column="startList"/>
		<result property="endPage" column="endPage"/>
		<result property="prev" column="prev"/>
		<result property="next" column="next"/>
	</resultMap>
	
	<resultMap id="user" type="egovframework.example.login.vo.userVo">
		<result property="user_id" column="user_id"/>
		<result property="user_pswd" column="user_pswd"/>
		<result property="state" column="state"/>
		<result property="user_name" column="user_name"/>
	</resultMap>
	
  <!-- 글작성 -->
	<insert id="insert_board">
			<![CDATA[
        	INSERT INTO board(
        	user_id
        	, title
        	, content
        	, file_name
        	)
        	VALUES(
        	#{user_id}
        	, #{title}
        	, #{content}
        	, #{file_name})
        	]]>
	</insert>
	<!-- 글수정 -->
	<update id="update_board" parameterType="egovframework.example.board.vo.boardVo">
			UPDATE 
				board 
			SET  
				title = #{title}
				, content = #{content}
				, file_name = #{file_name}
			WHERE 
				board_id = #{board_id}
	</update>

	
	<!-- 게시글 목록 조회 -->
    <select id="find_board_list" resultType="egovframework.example.board.vo.boardVo">
        SELECT board_id
				, user_id
				, title
				, content
				, file_name
				, reg_dtm 
		FROM board
        <where>
        	AND state = "N"
            <if test="searchType=='title' and keyword != null and keyword !=''">
                AND title like CONCAT('%',#{keyword},'%')
            </if>
            <if test="searchType=='content' and keyword != null and keyword !=''">
                AND content like CONCAT('%',#{keyword},'%')
            </if>
        </where>
        ORDER BY board_id DESC
        LIMIT #{startList}, #{listSize}
    </select>

	<!-- select content 게시글view-->
	<select id="find_content" resultType="egovframework.example.board.vo.boardVo">
			SELECT
				board_id
				, user_id
				, title
				, content
				, file_name
				, reg_dtm
			FROM
				board
			WHERE
				board_id = #{board_id}
	</select>
	
	<!-- 게시글 갯수 -->
	<select id="getBoardListCnt" resultType="Integer">
        SELECT count(*) as listCnt
        FROM board
        <where>
            <if test="keyword != null and keyword != ''">
                <if test="searchType=='title'">
                    AND title like CONCAT('%',#{keyword},'%')
                </if>
                <if test="searchType=='content'">
                    AND content like CONCAT('%',#{keyword},'%')
                </if>
            </if>
        </where>
    </select>
    
    <!-- 게시글 삭제 -->
    <update id="deleteBoard" parameterType="egovframework.example.board.vo.boardVo">
    	UPDATE 
			board 
		SET  
			state = 'D'
		WHERE 
			board_id = #{board_id}
			AND user_id = #{user_id}
    </update>
</mapper>
